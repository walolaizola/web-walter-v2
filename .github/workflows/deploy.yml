name: Deploy to Hostinger

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  web-deploy:
    name: ğŸ‰ Deploy
    runs-on: ubuntu-latest
    steps:
    - name: ğŸšš Get latest code
      uses: actions/checkout@v4

    - name: ğŸŸ¢ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'

    - name: ğŸ“¦ Install dependencies
      run: npm install

    - name: ğŸ—ï¸ Build Project
      run: npm run build

    # VERSIÃ“N ANTERIOR (sin verificaciÃ³n ni ajustes)
    # - name: ğŸ“‚ Sync files to Hostinger
    #   uses: SamKirkland/FTP-Deploy-Action@v4.3.5
    #   with:
    #     server: ${{ secrets.FTP_SERVER }}
    #     username: ${{ secrets.FTP_USERNAME }}
    #     password: ${{ secrets.FTP_PASSWORD }}
    #     local-dir: './dist/'
    #     server-dir: './domains/walolaizola.com/public_html/'

    # NUEVA VERSIÃ“N (con verificaciÃ³n y ruta corregida)
    - name: ğŸ“‹ Verify build output
      run: |
        echo "Built files:"
        ls -la ./dist/
        echo "File count:"
        find ./dist -type f | wc -l

    - name: ğŸ“‚ Sync files to Hostinger
      uses: SamKirkland/FTP-Deploy-Action@v4.3.5
      with:
        server: ${{ secrets.FTP_SERVER }}
        username: ${{ secrets.FTP_USERNAME }}
        password: ${{ secrets.FTP_PASSWORD }}
        local-dir: './dist/'
        #server-dir: './'  # NO FUNCIONABA
        #server-dir: 'domains/walolaizola.com/public_html/' # NO FUNCIONABA
        server-dir: '../domains/walolaizola.com/public_html/'  # â¬…ï¸ Esto sube un nivel - CON ESTO SI FUNCIONÃ“!!!
        dangerous-clean-slate: true  # âš ï¸ Borra todo y sube de nuevo
        state-name: '.ftp-deploy-sync-state.json'
        log-level: verbose